<?xml version="1.0" encoding="UTF-8"?>
<package name="service-management" version="v0.1"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:noNamespaceSchemaLocation="plugin-config-v2.xsd">

    <!-- 1.析 - 描述运行本插件包需要的其他插件包 -->
    <packageDependencies>
        <packageDependency name='xxx' version='1.0'/>
        <packageDependency name='xxx233' version='1.5'/>
    </packageDependencies>

    <!-- 2.菜单注入 - 描述运行本插件包需要注入的菜单 -->
    <menus>
        <menu code='JOBS_SERVICE_CATALOG_MANAGEMENT' cat='JOBS' displayName="Servive Catalog Management">/service-catalog</menu>
        <menu code='JOBS_TASK_MANAGEMENT' cat='JOBS' displayName="Task Management">/task-management</menu>
    </menus>

    <!-- 3.数据模型 - 描述本插件包的数据模型,并且描述和Framework数据模型的关系 -->
    <dataModel isDynamic="false">
    </dataModel>

    <!-- 4.系统参数 - 描述运行本插件包需要的系统参数 -->
    <systemParameters>
        <systemParameter name="xxx" defaultValue='xxxx' scopeType='global'/>
        <systemParameter name="xxx" defaultValue='xxxx' scopeType='plugin-package'/>
    </systemParameters>

    <!-- 5.权限设定 -->
    <authorities>
        <authority systemRoleName="admin" >
            <menu code="JOBS_SERVICE_CATALOG_MANAGEMENT" />
            <menu code="JOBS_TASK_MANAGEMENT" />
        </authority >
        <authority systemRoleName="wecube_operator" >
            <menu code="JOBS_TASK_MANAGEMENT" />
        </authority >
    </authorities>

    <!-- 6.运行资源 - 描述部署运行本插件包需要的基础资源(如主机、虚拟机、容器、数据库等) -->
    <resourceDependencies>
        <docker imageName="service_management" containerName="service_management" portBindings="22000:21000" volumeBindings="" envVariables="-e DATA_SOURCE_URL={%s} -e DB_USER={%s} -e DB_PWD={%s} -e CORE_ADDR={%s}"/>
        <mysql schema="service_management" initFileName="init.sql" upgradeFileName="upgrade.sql"/>
        <s3 bucketName="service_management"/>
    </resourceDependencies>

    <!-- 7.插件列表 - 描述插件包中单个插件的输入和输出 -->
    <plugins>
        <plugin name="task">
            <interface action="create" path="/service-management/tasks" httpMethod='POST'>
                <inputParameters>
                    <parameter datatype="string" mappingType='system_variable' mappingSystemVariableId='1' required='Y'>callbackUrl</parameter>
                    <parameter datatype="string" mappingType='context'  required='N'>description</parameter>
                    <parameter datatype="string" mappingType='context' required='Y'>name</parameter>
                    <parameter datatype="string" mappingType='entity' mappingEntityExpression='name_xxx' required='Y'>operatorRoleId</parameter>
                    <parameter datatype="string" mappingType='context' required='Y'>processDefinitionKey</parameter>
                    <parameter datatype="string" mappingType='context' required='Y'>processInstanceId</parameter>
                    <parameter datatype="string" mappingType='context' required='Y'>reporter</parameter>
                    <parameter datatype="string" mappingType='context' required='Y'>serviceRequestId</parameter>
                </inputParameters>
                <outputParameters>
                    <parameter datatype="string">status</parameter>
                    <parameter datatype="string">message</parameter>
                </outputParameters>
            </interface>
        </plugin>
        <plugin name="service request management">
            <interface action="update" path="/service-management/service-requests/{service-request-id}/done" httpMethod='PUT'>
                <inputParameters>
                    <parameter datatype="string" mappingType='system_variable' mappingSystemVariableId='1' required='Y'>service-request-id</parameter>
                    <parameter datatype="string" mappingType='context'  required='Y'>result</parameter>
                </inputParameters>
                <outputParameters>
                    <parameter datatype="string">status</parameter>
                    <parameter datatype="string">message</parameter>
                </outputParameters>
            </interface>
        </plugin>
    </plugins>
</package>