(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-de9ee160"],{"48b1":function(e,t,o){var r=o("c0d7");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var n=o("2fb2").default;n("3143c845",r,!0,{})},"4ca9":function(e,t,o){"use strict";o.r(t);o("6762"),o("2fdb"),o("7514"),o("ac6a"),o("6b54"),o("a481"),o("96cf");var r=o("3b8d"),n=o("aa22"),a=o("fd32"),s=(o("6d21"),function(e,t,o){for(var r=document.querySelectorAll(e),n=r.length,a=0;a<n;a++){var s=r[a];s.removeEventListener(t,o),s.addEventListener(t,o)}}),i=function(e,t,o){for(var r=document.querySelectorAll(e),n=r.length,a=0;a<n;a++){var s=r[a];s.removeEventListener(t,o)}},d=[{id:"UNIT_APP",srcGraphNodeIds:[],succeedingNodeIds:["INS1","INS2","PACK_V1"],refFlowNodeIds:[]},{id:"INS1",srcGraphNodeIds:["UNIT_APP"],succeedingNodeIds:["HOST1","PACK_V1"],refFlowNodeIds:[]},{id:"HOST1",srcGraphNodeIds:["INS1"],succeedingNodeIds:["DISK1","IP1"],refFlowNodeIds:[]},{id:"DISK1",srcGraphNodeIds:["HOST1"],succeedingNodeIds:[],refFlowNodeIds:[]},{id:"IP1",srcGraphNodeIds:["HOST1"],succeedingNodeIds:[],refFlowNodeIds:[]},{id:"PACK_V1",srcGraphNodeIds:["INS1","UNIT_APP","INS2"],succeedingNodeIds:["USER"],refFlowNodeIds:[]},{id:"USER",srcGraphNodeIds:["PACK_V1"],succeedingNodeIds:[],refFlowNodeIds:[]},{id:"INS2",srcGraphNodeIds:["UNIT_APP"],succeedingNodeIds:["HOST2","PACK_V1"],refFlowNodeIds:[]},{id:"HOST2",srcGraphNodeIds:["INS2"],succeedingNodeIds:["IP2","DISK2"],refFlowNodeIds:[]},{id:"IP2",srcGraphNodeIds:["HOST2"],succeedingNodeIds:[],refFlowNodeIds:[]},{id:"DISK2",srcGraphNodeIds:["HOST2"],succeedingNodeIds:[],refFlowNodeIds:[]}],l={data:function(){return{graph:{},flowGraph:{},modelData:d,flowData:{},allFlows:[],allTarget:[],currentFlowNodeId:"",foundRefAry:[],selectedFlow:"",selectedTarget:"",showExcution:!0,isShowBody:!1,isEnqueryPage:!1}},mounted:function(){this.getSelectionData(),this.getAllFlow()},methods:{getAllFlow:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,o,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(n["j"])(!1);case 2:t=e.sent,o=t.status,r=t.data,t.message,"OK"===o&&(this.allFlows=r);case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getSelectionData:function(){this.allTarget=[{id:1,regx:"A-B.c"},{id:2,regx:"D-C.c"}]},orchestrationSelectHandler:function(){this.getFlowOutlineData()},queryHandler:function(){var e=this;this.selectedFlow&&(this.isShowBody=!0,this.isEnqueryPage=!0,this.$nextTick(function(){e.getModelData(),e.getFlowOutlineData()}))},createHandler:function(){this.isShowBody=!0,this.isEnqueryPage=!1,this.selectedTarget="",this.selectedFlow=""},createFlowHandler:function(){console.log("selectedTarget is: ",this.selectedTarget),this.getModelData()},getModelData:function(){this.initModelGraph()},getFlowOutlineData:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,o,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(n["w"])(this.selectedFlow);case 2:t=e.sent,o=t.status,r=t.data,t.message,"OK"===o&&(this.flowData=r,this.initFlowGraph());case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),renderModelGraph:function(){var e=this,t=this.modelData.map(function(e,t){var o=e.isHighlight?"#5DB400":"black",r=e.refFlowNodeIds.length>0,n=r?"Mrecord":"ellipse",a=e.refFlowNodeIds.toString().replace(/,/g,"/")+(r?"|":"")+e.id;return"".concat(e.id,' [label="').concat(a,'" class="model" id="').concat(e.id,'" color="').concat(o,'" shape="').concat(n,'" ]')}),o=function(){var t=[];return e.modelData.forEach(function(e){if(e.succeedingNodeIds.length>0){var o=[];o=e.succeedingNodeIds.map(function(t){return e.id+" -> "+t}),t.push(o)}}),t.flat().toString().replace(/,/g,";")},r='digraph G { bgcolor="transparent";Node [fontname=Arial, shape="ellipse", fixedsize="true", width="1.6", height=".8",fontsize=12];Edge [fontname=Arial, minlen="1", color="#7f8fa6", fontsize=10];'+t.toString().replace(/,/g,"; ")+";"+o()+"}";this.graph.graphviz.renderDot(r).fit(!0)},renderFlowGraph:function(e){var t=this,o={Completed:"#5DB400",deployed:"#7F8A96",InProgress:"#3C83F8",Faulted:"#FF6262",Timeouted:"#F7B500"},r=this.flowData.flowNodes.map(function(r,n){return"startEvent"===r.nodeType||"endEvent"===r.nodeType?"".concat(r.nodeId,' [label="').concat(r.nodeName,'", fontsize="10", class="flow",style="').concat(e?"filled":"none",'" color="').concat(e?o[r.status]:"#7F8A96",'" shape="circle", id="').concat(r.nodeId,'"]'):(console.log(111,e,o[r.status],r.status),"".concat(r.nodeId,' [label="').concat(r.orderedNo+"、"+r.nodeName,'" fontsize="10" class="flow" style="').concat(e?"filled":"none",'" color="').concat(e?o[r.status]:r.nodeId===t.currentFlowNodeId?"#5DB400":"#7F8A96",'"  shape="record" id="').concat(r.nodeId,'"] height=.2'))}),n=function(){var r=[];return t.flowData.flowNodes.forEach(function(t){if(t.succeedingNodeIds.length>0){var n=[];n=t.succeedingNodeIds.map(function(r){return t.nodeId+" -> "+"".concat(r,' [color="').concat(e?o[t.status]:"black",'"]')}),r.push(n)}}),r.flat().toString().replace(/,/g,";")},a='digraph G {bgcolor="transparent";Node [fontname=Arial, height=".3", fontsize=12];Edge [fontname=Arial, color="#7f8fa6", fontsize=10];'+r.toString().replace(/,/g,";")+";"+n()+"}";this.flowGraph.graphviz.renderDot(a).fit(!0),this.bindFlowEvent()},excutionFlow:function(){var e=this;this.isEnqueryPage||(this.selectedFlow=1),this.showExcution=!1,this.isEnqueryPage=!0,this.flowData.flowNodes.forEach(function(t,o){setTimeout(function(){o>0&&(e.flowData.flowNodes[o-1].status="Completed"),t.status="InProgress",e.renderFlowGraph(!0)},3e3*o)})},bindFlowEvent:function(){var e=this;!0!==this.isEnqueryPage&&(s(".flow","mouseover",function(e){e.preventDefault(),e.stopPropagation(),a["selectAll"]("g").attr("cursor","pointer")}),s(".flow","click",function(t){t.preventDefault(),t.stopPropagation();var o=t.currentTarget;e.highlightModel(o.id),e.currentFlowNodeId=o.id,e.renderFlowGraph()}))},highlightModel:function(e){var t=this;this.foundRefAry=this.flowData.flowNodes.find(function(t){return t.nodeId==e}).previousNodeIds,this.modelData.forEach(function(e){e["isHighlight"]=t.foundRefAry.includes(e.nodeId)}),this.renderModelGraph(),i(".model","click",this.modelClickHandler),this.foundRefAry.forEach(function(e){s("#".concat(e),"click",t.modelClickHandler)})},modelClickHandler:function(e){var t=this;e.preventDefault(),e.stopPropagation();var o=e.currentTarget,r=this.modelData.find(function(e){return e.id==o.id}),n=r.refFlowNodeIds.indexOf(this.currentFlowNodeId);n>-1?r.refFlowNodeIds.splice(n,1):r.refFlowNodeIds.push(this.currentFlowNodeId),document.getElementById("graph").innerHTML="",this.renderModelGraph(),this.foundRefAry.forEach(function(e){s("#".concat(e),"click",t.modelClickHandler)})},initModelGraph:function(){var e=this,t=function(){var t;t=a["select"]("#graph"),t.on("dblclick.zoom",null),e.graph.graphviz=t.graphviz().zoom(!1)};t(),this.renderModelGraph()},initFlowGraph:function(){var e=this,t=function(){var t;t=a["select"]("#flow"),t.on("dblclick.zoom",null),e.flowGraph.graphviz=t.graphviz().zoom(!1)};t(),this.renderFlowGraph()}}},c=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("Card",{attrs:{"dis-hover":""}},[o("Row",[o("Col",{attrs:{span:"20"}},[o("Form",{attrs:{"label-position":"left"}},[o("FormItem",{attrs:{"label-width":150,label:e.$t("orchs")}},[o("Select",{staticStyle:{width:"70%"},attrs:{label:"",clearable:""},model:{value:e.selectedFlow,callback:function(t){e.selectedFlow=t},expression:"selectedFlow"}},e._l(e.allFlows,function(t){return o("Option",{key:t.procDefId,attrs:{value:t.procDefId}},[e._v("\n                "+e._s(t.procDefName+" version_"+t.procDefVersion+" "+(t.timestamp||"timestap")+" "+(t.createBy||"createBy"))+"\n              ")])}),1),e._v(" "),o("Button",{attrs:{type:"info"},on:{click:e.queryHandler}},[e._v("\n              "+e._s(e.$t("query_orch"))+"\n            ")]),e._v(" "),o("Button",{attrs:{type:"success"},on:{click:e.createHandler}},[e._v("\n              "+e._s(e.$t("create_orch"))+"\n            ")])],1)],1)],1)],1),e._v(" "),e.isShowBody?o("Row",{staticStyle:{border:"1px solid #ebe7e7","border-radius":"3px",padding:"20px"}},[o("Row",[o("Form",[o("Col",{attrs:{span:"6"}},[o("FormItem",{attrs:{"label-width":100,label:e.$t("select_orch")}},[o("Select",{attrs:{label:"",disabled:e.isEnqueryPage},on:{"on-change":e.orchestrationSelectHandler},model:{value:e.selectedFlow,callback:function(t){e.selectedFlow=t},expression:"selectedFlow"}},e._l(e.allFlows,function(t){return o("Option",{key:t.procDefId,attrs:{value:t.procDefId}},[e._v("\n                  "+e._s(t.procDefName)+"\n                ")])}),1)],1)],1),e._v(" "),o("Col",{attrs:{span:"8"}},[o("FormItem",{attrs:{"label-width":100,label:e.$t("target_object")}},[o("Select",{attrs:{label:"",disabled:e.isEnqueryPage},on:{"on-change":e.createFlowHandler},model:{value:e.selectedTarget,callback:function(t){e.selectedTarget=t},expression:"selectedTarget"}},e._l(e.allTarget,function(t){return o("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.regx))])}),1)],1)],1)],1)],1),e._v(" "),o("Row",{staticStyle:{border:"1px solid #d3cece","border-radius":"3px",padding:"20px"}},[o("Col",{staticStyle:{"border-right":"1px solid #d3cece","text-align":"center"},attrs:{span:"6"}},[o("div",{staticClass:"graph-container",attrs:{id:"flow"}})]),e._v(" "),o("Col",{staticStyle:{"text-align":"center","margin-top":"60px"},attrs:{span:"18"}},[o("div",{staticClass:"graph-container",attrs:{id:"graph"}}),e._v(" "),o("div",{staticStyle:{"text-align":"center","margin-top":"60px"}},[e.showExcution?o("Button",{attrs:{type:"info"},on:{click:e.excutionFlow}},[e._v("\n              "+e._s(e.$t("execute"))+"\n            ")]):e._e()],1)])],1)],1):e._e()],1)],1)},u=[],h=o("2455");function f(e){o("48b1")}var p=!1,g=f,w="data-v-94226cfe",I=null,v=Object(h["a"])(l,c,u,p,g,w,I);t["default"]=v.exports},c0d7:function(e,t,o){t=e.exports=o("2350")(!1),t.push([e.i,"body[data-v-94226cfe]{color:#15a043}",""])}}]);
//# sourceMappingURL=chunk-de9ee160.0e64c68d.js.map