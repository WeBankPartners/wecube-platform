(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-29f9409c"],{"2fdb":function(t,e,r){"use strict";var o=r("5ca1"),a=r("d2c8"),n="includes";o(o.P+o.F*r("5147")(n),"String",{includes:function(t){return!!~a(this,t,n).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},"4ca9":function(t,e,r){"use strict";r.r(e);r("6762"),r("2fdb"),r("7f7f"),r("ac6a"),r("6b54"),r("a481"),r("7514"),r("aa22");var o=r("fd32"),a=(r("6d21"),function(t,e,r){for(var o=document.querySelectorAll(t),a=o.length,n=0;n<a;n++){var s=o[n];s.removeEventListener(e,r),s.addEventListener(e,r)}}),n=function(t,e,r){for(var o=document.querySelectorAll(t),a=o.length,n=0;n<a;n++){var s=o[n];s.removeEventListener(e,r)}},s=[{id:"UNIT_APP",srcGraphNodeIds:[],toGraphNodeIds:["INS1","INS2","PACK_V1"],refFlowNodeIds:[]},{id:"INS1",srcGraphNodeIds:["UNIT_APP"],toGraphNodeIds:["HOST1","PACK_V1"],refFlowNodeIds:[]},{id:"HOST1",srcGraphNodeIds:["INS1"],toGraphNodeIds:["DISK1","IP1"],refFlowNodeIds:[]},{id:"DISK1",srcGraphNodeIds:["HOST1"],toGraphNodeIds:[],refFlowNodeIds:[]},{id:"IP1",srcGraphNodeIds:["HOST1"],toGraphNodeIds:[],refFlowNodeIds:[]},{id:"PACK_V1",srcGraphNodeIds:["INS1","UNIT_APP","INS2"],toGraphNodeIds:["USER"],refFlowNodeIds:[]},{id:"USER",srcGraphNodeIds:["PACK_V1"],toGraphNodeIds:[],refFlowNodeIds:[]},{id:"INS2",srcGraphNodeIds:["UNIT_APP"],toGraphNodeIds:["HOST2","PACK_V1"],refFlowNodeIds:[]},{id:"HOST2",srcGraphNodeIds:["INS2"],toGraphNodeIds:["IP2","DISK2"],refFlowNodeIds:[]},{id:"IP2",srcGraphNodeIds:["HOST2"],toGraphNodeIds:[],refFlowNodeIds:[]},{id:"DISK2",srcGraphNodeIds:["HOST2"],toGraphNodeIds:[],refFlowNodeIds:[]}],d=[{id:0,name:"Start",status:"NotStarted",toGraphNodeIds:[1],refGraphNodeIds:[]},{id:1,name:"Create VM",toGraphNodeIds:[2],status:"NotStarted",refGraphNodeIds:["HOST1","HOST2"]},{id:2,name:"Create Disk",status:"NotStarted",toGraphNodeIds:[3],refGraphNodeIds:["DISK1","DISK2"]},{id:3,name:"Install saltstack agent",status:"NotStarted",toGraphNodeIds:[4],refGraphNodeIds:["INS1","INS2"]},{id:4,name:"Install monitor agent",status:"NotStarted",toGraphNodeIds:[5],refGraphNodeIds:["HOST1","HOST2"]},{id:5,name:"Create Deploy User",status:"NotStarted",toGraphNodeIds:[6],refGraphNodeIds:["HOST1","HOST2"]},{id:6,name:"Differential variable replacement",status:"NotStarted",toGraphNodeIds:[7],refGraphNodeIds:["HOST1","HOST2"]},{id:7,name:"Artifacts distribution",status:"NotStarted",toGraphNodeIds:[8],refGraphNodeIds:["HOST1","HOST2"]},{id:8,name:"Deployment",status:"NotStarted",toGraphNodeIds:[9],refGraphNodeIds:["HOST1","HOST2"]},{id:9,name:"Start up",status:"NotStarted",toGraphNodeIds:[10],refGraphNodeIds:["HOST1","HOST2"]},{id:10,name:"End",toGraphNodeIds:[],refGraphNodeIds:[]}],i=[{id:1,orchestration:{orchestrationId:1001,orchestrationName:"App Deployment"},target:{targetId:2001,targetName:"Deposit System - Core Subsystem - APP Unit"},timestamp:"2018.01.01 12:22:23",createBy:"Chaney Liu"},{id:2,orchestration:{orchestrationId:1002,orchestrationName:"Create Server Farm Zone"},target:{targetId:2002,targetName:"SZ1-DMZ"},timestamp:"2018.12.12 16:44:23",createBy:"Tong Zhang"}],l={data:function(){return{graph:{},flowGraph:{},modelData:s,flowData:d,allFlows:i,allOrchestration:[],allTarget:[],currentFlowNodeId:"",foundRefAry:[],selectedFlow:"",selectedOrchestration:"",selectedTarget:"",showExcution:!0,isShowBody:!1,isEnqueryPage:!1}},mounted:function(){this.getSelectionData()},methods:{getSelectionData:function(){this.allOrchestration=this.allFlows.map(function(t){return t.orchestration}),this.allTarget=this.allFlows.map(function(t){return t.target})},queryHandler:function(){var t=this;this.selectedFlow&&(this.isShowBody=!0,this.isEnqueryPage=!0,this.$nextTick(function(){var e=t.allFlows.find(function(e){return e.id===t.selectedFlow});t.selectedOrchestration=e.orchestration.orchestrationId,t.selectedTarget=e.target.targetId,t.getModelData(),t.getFlowData()}))},createHandler:function(){this.isShowBody=!0,this.isEnqueryPage=!1,this.selectedOrchestration="",this.selectedTarget="",this.selectedFlow=""},createFlowHandler:function(){this.getModelData(),this.getFlowData()},getModelData:function(){this.initModelGraph()},getFlowData:function(){this.initFlowGraph()},renderModelGraph:function(){var t=this,e=this.modelData.map(function(t,e){var r=t.isHighlight?"#5DB400":"black",o=t.refFlowNodeIds.length>0,a=o?"Mrecord":"ellipse",n=t.refFlowNodeIds.toString().replace(/,/g,"/")+(o?"|":"")+t.id;return"".concat(t.id,' [label="').concat(n,'" class="model" id="').concat(t.id,'" color="').concat(r,'" shape="').concat(a,'" ]')}),r=function(){var e=[];return t.modelData.forEach(function(t){if(t.toGraphNodeIds.length>0){var r=[];r=t.toGraphNodeIds.map(function(e){return t.id+" -> "+e}),e.push(r)}}),e.flat().toString().replace(/,/g,";")},o='digraph G { bgcolor="transparent";Node [fontname=Arial, shape="ellipse", fixedsize="true", width="1.6", height=".8",fontsize=12];Edge [fontname=Arial, minlen="1", color="#7f8fa6", fontsize=10];'+e.toString().replace(/,/g,"; ")+";"+r()+"}";this.graph.graphviz.renderDot(o).fit(!0)},renderFlowGraph:function(t){var e=this,r={Completed:"#5DB400",NotStarted:"#7F8A96",InProgress:"#3C83F8",Faulted:"#FF6262",Timeouted:"#F7B500"},o=this.flowData.map(function(o,a){return 0===a||a===e.flowData.length-1?"".concat(o.id,' [label="').concat((o.id>1&&o.id<e.flowData.length?o.id+"、":"")+o.name,'", fontsize="10", class="flow",style="').concat(t?"filled":"none",'" color="').concat(t?r[o.status]:"#7F8A96",'" shape="circle", id="').concat(o.id,'"]'):"".concat(o.id,' [label="').concat((o.id>0&&o.id<e.flowData.length?o.id+"、":"")+o.name,'" fontsize="10" class="flow" style="').concat(t?"filled":"none",'" color="').concat(t?r[o.status]:o.id===1*e.currentFlowNodeId?"#5DB400":"#7F8A96",'"  shape="record" id="').concat(o.id,'"] height=.2')}),a=function(){var o=[];return e.flowData.forEach(function(e){if(e.toGraphNodeIds.length>0){var a=[];a=e.toGraphNodeIds.map(function(o){return e.id+" -> "+"".concat(o,' [color="').concat(t?r[e.status]:"black",'"]')}),o.push(a)}}),o.flat().toString().replace(/,/g,";")},n='digraph G {bgcolor="transparent";Node [fontname=Arial, height=".3", fontsize=12];Edge [fontname=Arial, color="#7f8fa6", fontsize=10];'+o.toString().replace(/,/g,";")+";"+a()+"}";this.flowGraph.graphviz.renderDot(n).fit(!0),this.bindFlowEvent()},excutionFlow:function(){var t=this;this.isEnqueryPage||(this.selectedFlow=1),this.showExcution=!1,this.isEnqueryPage=!0,this.flowData.forEach(function(e,r){setTimeout(function(){r>0&&(t.flowData[r-1].status="Completed"),e.status="InProgress",t.renderFlowGraph(!0)},3e3*r)})},bindFlowEvent:function(){var t=this;!0!==this.isEnqueryPage&&(a(".flow","mouseover",function(t){t.preventDefault(),t.stopPropagation(),o["selectAll"]("g").attr("cursor","pointer")}),a(".flow","click",function(e){e.preventDefault(),e.stopPropagation();var r=e.currentTarget;t.highlightModel(r.id),t.currentFlowNodeId=r.id,t.renderFlowGraph()}))},highlightModel:function(t){var e=this;this.foundRefAry=this.flowData.find(function(e){return e.id==t}).refGraphNodeIds,this.modelData.forEach(function(t){t["isHighlight"]=e.foundRefAry.includes(t.id)}),this.renderModelGraph(),n(".model","click",this.modelClickHandler),this.foundRefAry.forEach(function(t){a("#".concat(t),"click",e.modelClickHandler)})},modelClickHandler:function(t){var e=this;t.preventDefault(),t.stopPropagation();var r=t.currentTarget,o=this.modelData.find(function(t){return t.id==r.id}),n=o.refFlowNodeIds.indexOf(this.currentFlowNodeId);n>-1?o.refFlowNodeIds.splice(n,1):o.refFlowNodeIds.push(this.currentFlowNodeId),document.getElementById("graph").innerHTML="",this.renderModelGraph(),this.foundRefAry.forEach(function(t){a("#".concat(t),"click",e.modelClickHandler)})},initModelGraph:function(){var t=this,e=function(){var e;e=o["select"]("#graph"),e.on("dblclick.zoom",null),t.graph.graphviz=e.graphviz().zoom(!1)};e(),this.renderModelGraph()},initFlowGraph:function(){var t=this,e=function(){var e;e=o["select"]("#flow"),e.on("dblclick.zoom",null),t.flowGraph.graphviz=e.graphviz().zoom(!1)};e(),this.renderFlowGraph()}}},c=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("Card",{attrs:{"dis-hover":""}},[r("Row",[r("Col",{attrs:{span:"20"}},[r("Form",[r("FormItem",{attrs:{"label-width":150,label:t.$t("orchs")}},[r("Select",{staticStyle:{width:"70%"},attrs:{label:"",clearable:""},model:{value:t.selectedFlow,callback:function(e){t.selectedFlow=e},expression:"selectedFlow"}},t._l(t.allFlows,function(e){return r("Option",{key:e.id,attrs:{value:e.id}},[t._v("\n                "+t._s(e.orchestration.orchestrationName+" "+e.target.targetName+" "+e.timestamp+" "+e.createBy)+"\n              ")])}),1),t._v(" "),r("Button",{attrs:{type:"info"},on:{click:t.queryHandler}},[t._v(t._s(t.$t("query_orch")))]),t._v(" "),r("Button",{attrs:{type:"success"},on:{click:t.createHandler}},[t._v(t._s(t.$t("create_orch")))])],1)],1)],1)],1),t._v(" "),t.isShowBody?r("Row",{staticStyle:{border:"1px solid #ebe7e7","border-radius":"3px",padding:"20px"}},[r("Row",[r("Form",[r("Col",{attrs:{span:"6"}},[r("FormItem",{attrs:{"label-width":100,label:t.$t("select_orch")}},[r("Select",{attrs:{label:"",disabled:t.isEnqueryPage},model:{value:t.selectedOrchestration,callback:function(e){t.selectedOrchestration=e},expression:"selectedOrchestration"}},t._l(t.allOrchestration,function(e){return r("Option",{key:e.orchestrationId,attrs:{value:e.orchestrationId}},[t._v("\n                  "+t._s(e.orchestrationName)+"\n                ")])}),1)],1)],1),t._v(" "),r("Col",{attrs:{span:"8"}},[r("FormItem",{attrs:{"label-width":100,label:t.$t("target_object")}},[r("Select",{attrs:{label:"",disabled:t.isEnqueryPage},model:{value:t.selectedTarget,callback:function(e){t.selectedTarget=e},expression:"selectedTarget"}},t._l(t.allTarget,function(e){return r("Option",{key:e.targetId,attrs:{value:e.targetId}},[t._v("\n                  "+t._s(e.targetName)+"\n                ")])}),1)],1)],1),t._v(" "),r("Col",{attrs:{span:"2",offset:"1"}},[t.isEnqueryPage?t._e():r("Button",{attrs:{type:"success"},on:{click:t.createFlowHandler}},[t._v(t._s(t.$t("create_job")))])],1)],1)],1),t._v(" "),r("Row",{staticStyle:{border:"1px solid #d3cece","border-radius":"3px",padding:"20px"}},[r("Col",{staticStyle:{"border-right":"1px solid #d3cece","text-align":"center"},attrs:{span:"6"}},[r("div",{staticClass:"graph-container",attrs:{id:"flow"}})]),t._v(" "),r("Col",{staticStyle:{"text-align":"center","margin-top":"60px"},attrs:{span:"18"}},[r("div",{staticClass:"graph-container",attrs:{id:"graph"}}),t._v(" "),r("div",{staticStyle:{"text-align":"center","margin-top":"60px"}},[t.showExcution?r("Button",{attrs:{type:"info"},on:{click:t.excutionFlow}},[t._v(t._s(t.$t("execute")))]):t._e()],1)])],1)],1):t._e()],1)],1)},h=[],f=r("2455");function u(t){r("d91f")}var p=!1,g=u,I="data-v-0e14363c",N=null,w=Object(f["a"])(l,c,h,p,g,I,N);e["default"]=w.exports},5147:function(t,e,r){var o=r("2b4c")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(r){try{return e[o]=!1,!"/./"[t](e)}catch(a){}}return!0}},6762:function(t,e,r){"use strict";var o=r("5ca1"),a=r("c366")(!0);o(o.P,"Array",{includes:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),r("9c6c")("includes")},"891b":function(t,e,r){e=t.exports=r("2350")(!1),e.push([t.i,"body[data-v-0e14363c]{color:#15a043}",""])},d2c8:function(t,e,r){var o=r("aae3"),a=r("be13");t.exports=function(t,e,r){if(o(e))throw TypeError("String#"+r+" doesn't accept regex!");return String(a(t))}},d91f:function(t,e,r){var o=r("891b");"string"===typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);var a=r("2fb2").default;a("6fa229fe",o,!0,{})}}]);
//# sourceMappingURL=chunk-29f9409c.05b661ce.js.map