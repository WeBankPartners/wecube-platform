(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7df42495"],{7168:function(e,t,n){var a=n("7e8c");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=n("2fb2").default;i("45c2c497",a,!0,{})},"7e8c":function(e,t,n){t=e.exports=n("2350")(!1),t.push([e.i,".ivu-card-head p[data-v-301ff99e]{height:30px;line-height:30px}.filter-title[data-v-301ff99e]{margin-right:10px}#physicalGraph[data-v-301ff99e]{position:relative;min-height:300px}",""])},8466:function(e,t,n){"use strict";n.r(t);n("8e6e"),n("456d"),n("a481");var a=n("75fc"),i=n("bd86"),r=n("768b"),s=(n("7514"),n("96cf"),n("3b8d")),o=(n("7f7f"),n("ac6a"),n("5df3"),n("f400"),n("fd32")),c=(n("6d21"),n("aa22")),u=n("ab33"),l=n("30be"),d=n("793c"),h=n("f0c6");function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(n,!0).forEach(function(t){Object(i["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var g=new Map([["new","#2f7344"],["created","#2f7344"],["update","dodgerblue"],["change","dodgerblue"],["destroyed","red"],["delete","red"]]),v=["#c8d6f0","#cde4fd","#acc1e8","#516282","#243047","#0f1624"],m={components:{PhysicalGraph:h["a"]},data:function(){return{tabList:[],systemDesigns:[],systemDesignVersion:"",deployTree:[],fixVersionTreeModal:!1,payload:{filters:[],pageable:{pageSize:10,startIndex:0},paging:!0,sorting:{}},systemDesignCiTypeId:"",invokeDesignCiTypeId:"",graph:{},systemDesignData:[],physicalGraphData:[],physicalGraphLinks:[],physicalGraphNodes:{},physicalGraphLineNodes:{serviceDesign:{},unitDesign:{}},currentTab:"architecture-design",spinShow:!1,isDataChanged:!1,physicalSpin:!1,invokeLines:[],isShowInvokeSequence:!1,invokeSequenceCode:"6",invokeSequenceForm:{isShowInvokeSequenceDetial:!1,invokeSequenceData:[],spliceInvokeSequenceList:"",totalNum:0,currentNum:0,currentInvokeSequenceTag:"",currentInvokeSequence:[],selectedInvokeSequence:""}}},computed:{tableRef:function(){return"table"+this.currentTab},needCheckout:function(){return"ciDataEnquiry"!==this.$route.name}},methods:{closeInvokeSquence:function(){this.invokeSequenceForm.totalNum=0,this.invokeSequenceForm.currentNum=0,this.invokeSequenceForm.selectedInvokeSequence="",this.invokeSequenceForm.currentInvokeSequenceTag="",this.invokeSequenceForm.currentInvokeSequence=[],this.invokeSequenceForm.isShowInvokeSequenceDetial=!1,this.invokeSequenceForm.spliceInvokeSequenceList="",this.initGraph()},backInvokeSequence:function(){if(this.invokeSequenceForm.currentNum>1){var e=this.invokeSequenceForm.currentInvokeSequence;this.invokeSequenceForm.currentNum=this.invokeSequenceForm.currentNum-1,this.invokeSequenceForm.currentInvokeSequenceTag=e[this.invokeSequenceForm.currentNum-1].key_name,this.reColorInvokeSequence()}},nextInvokeSequence:function(){if(this.invokeSequenceForm.currentNum<this.invokeSequenceForm.totalNum){var e=this.invokeSequenceForm.currentInvokeSequence;this.invokeSequenceForm.currentNum=this.invokeSequenceForm.currentNum+1,this.invokeSequenceForm.currentInvokeSequenceTag=e[this.invokeSequenceForm.currentNum-1].key_name,this.reColorInvokeSequence()}},getAllInvokeSequenceData:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,a,i,r=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.invokeSequenceForm.invokeSequenceData=[],t=this.tabList.find(function(e){return e.code===r.invokeSequenceCode}),e.next=4,Object(c["W"])(t.codeId,this.systemDesignVersion,{});case 4:n=e.sent,a=n.status,n.message,i=n.data,"OK"===a&&(this.invokeSequenceForm.invokeSequenceData=i.contents);case 9:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),onSearchInvokeSquence:function(){var e=this;this.invokeSequenceForm.isShowInvokeSequenceDetial=!0;var t=this.invokeSequenceForm.invokeSequenceData.find(function(t){return t.data.guid===e.invokeSequenceForm.selectedInvokeSequence});t&&(this.invokeSequenceForm.currentInvokeSequence=t.data.invoke_design_sequence,this.handleInvokeSquence(!0))},handleInvokeSquence:function(){var e=this.invokeSequenceForm.currentInvokeSequence,t=[];e.forEach(function(e){t.push(e.key_name)}),this.invokeSequenceForm.spliceInvokeSequenceList=t.join(" -> "),e.length>0&&(this.invokeSequenceForm.totalNum=e.length,this.invokeSequenceForm.currentNum=1,this.invokeSequenceForm.currentInvokeSequenceTag=e[0].key_name),this.reColorInvokeSequence()},reColorInvokeSequence:function(){var e=this;this.initGraph(),this.shadeAll(),this.invokeSequenceForm.currentInvokeSequence.forEach(function(t){e.reColorCurrentInvokeSequenceNode(t.service_design,"ellipse","green"),e.reColorCurrentInvokeSequenceNode(t.unit_design,"polygon","green"),e.reColorCurrentInvokeSequenceLine(t,"green")});var t=this.invokeSequenceForm.currentNum,n=this.invokeSequenceForm.currentInvokeSequence[t-1];this.reColorCurrentInvokeSequenceLine(n,"red")},onArchFixVersion:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(""!==this.systemDesignVersion){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Object(c["lc"])(this.systemDesignVersion);case 4:t=e.sent,n=t.status,a=t.message,t.data,"OK"===n&&(this.$Notice.success({title:"Success",desc:a}),this.fixVersionTreeModal=!1);case 9:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),cancelFixVersion:function(){this.fixVersionTreeModal=!1},reloadHandler:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.onArchChange(),this.isDataChanged=!1;case 2:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),onArchChange:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,a,i=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["z"])();case 2:if(t=e.sent,n=t.status,t.message,a=t.data,"OK"===n&&a.forEach(function(e){"system_design"===e.tableName&&(i.systemDesignCiTypeId=e.ciTypeId+""),"invoke_design"===e.tableName&&(i.invokeDesignCiTypeId=e.ciTypeId)}),""!==this.systemDesignVersion){e.next=9;break}return e.abrupt("return");case 9:this.spinShow=!0,this.physicalSpin=!0,this.getAllDesignTreeFromSystemDesign(),this.getPhysicalGraphData();case 13:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getAllDesignTreeFromSystemDesign:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["D"])(this.systemDesignVersion);case 2:return t=e.sent,n=t.status,t.message,a=t.data,"OK"===n&&(this.getAllInvokeSequenceData(),this.systemDesignData=a||[],this.initGraph()),e.next=9,Object(c["wc"])(this.systemDesignCiTypeId,{guid:this.systemDesignVersion});case 9:e.sent;case 10:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getPhysicalGraphData:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,a,i,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.physicalGraphData=[],t=[Object(c["V"])(this.systemDesignVersion),Object(c["S"])()],e.next=4,Promise.all(t);case 4:n=e.sent,a=Object(r["a"])(n,2),i=a[0],s=a[1],"OK"===i.status&&(i.data.length?this.physicalGraphData=i.data:(this.physicalGraphData=[],this.physicalSpin=!1)),"OK"===s.status&&(this.physicalGraphLinks=s.data||[]);case 10:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),graphCallback:function(){this.physicalSpin=!1},querySysTree:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(""!==this.systemDesignVersion){e.next=2;break}return e.abrupt("return");case 2:return this.spinShow=!0,e.next=5,Object(c["D"])(this.systemDesignVersion);case 5:t=e.sent,n=t.status,t.message,a=t.data,"OK"===n&&(this.spinShow=!1,this.systemDesignData=a||[],this.deployTree=this.formatTree(this.systemDesignData),this.fixVersionTreeModal=!0);case 10:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),formatTree:function(e){var t=this;return e.map(function(e){return e.children&&e.children.length>0?f({},e,{title:e.data.key_name,id:e.guid,expand:!0,disableCheckbox:!e.data.orchestration,children:t.formatTree(e.children)}):f({},e,{title:e.data.key_name,id:e.guid,expand:!0,disableCheckbox:!e.data.orchestration})})},initGraph:function(){var e,t=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isShowInvokeSequence=!0,this.spinShow=!0;var n=function(){e=o["select"]("#graph"),e.on("dblclick.zoom",null).on("wheel.zoom",null).on("mousewheel.zoom",null),t.graph.graphviz=e.graphviz().scale(1.2).width(.96*window.innerWidth).height(.8*window.innerHeight).zoom(!0)};n(),this.renderGraph(this.systemDesignData),this.spinShow=!1},genDOT:function(e){this.physicalGraphNodes={},this.physicalGraphLineNodes={serviceDesign:{},unitDesign:{}},this.invokeLines=[];var t=16,n=12,i=["digraph G{","rankdir=LR nodesep=0.5;","Node [fontname=Arial, fontsize=12];",'Edge [fontname=Arial, minlen="2",fontsize=10];','size="'.concat(t,",").concat(n,'";'),"subgraph cluster_".concat(e[0].guid," {"),'style="filled";color="#c8d6f0";','tooltip="'.concat(e[0].data.description,'";'),'label="'.concat(e[0].data.code,'";'),this.genChildrenDot(e[0].children||[],1),"}"].concat(Object(a["a"])(this.invokeLines),[this.renderOtherNodes(),"}"]);return console.log(i.join("").replace(/;/g,";\n").replace(/]/g,"]\n")),i.join("")},genChildrenDot:function(e,t){var n=this,a=[];return e.forEach(function(e){e.children instanceof Array&&e.children.length?a=a.concat(["subgraph cluster_".concat(e.guid,"{"),'id="g_'.concat(e.guid,'";'),'style="filled";color="'.concat(v[t],'";'),'label="'.concat(e.data.code||e.data.key_name,'";'),'tooltip="'.concat(e.data.description||e.data.name,'"'),3===e.ciTypeId?n.genServiceInvokeLine(e):n.genChildrenDot(e.children,t+1),"}"]):(n.physicalGraphNodes[e.guid]=e,a=a.concat(['"'.concat(e.guid,'"'),'[id="n_'.concat(e.guid,'";'),'label="'.concat(e.data.code||e.data.key_name,'";'),"shape=box;",'style="filled";color="'.concat(v[t],'";'),'tooltip="'.concat(e.data.description||e.data.name,'"];')]))}),a.join("")},genServiceInvokeLine:function(e){var t=this,n=(e.data.code||e.data.key_name,[]),i=[];return e.children.forEach(function(e){4===e.ciTypeId?n.push(e):5===e.ciTypeId&&i.push(e)}),i.length&&i.forEach(function(e){var n="grey";e.data.state&&g.has(e.data.state.code)&&(n=g.get(e.data.state.code)),t.invokeLines.push("gn_".concat(e.data.unit_design.guid," -> gn_").concat(e.data.service_design.guid,' [id="gl_').concat(e.guid,'",color="').concat(n,'",taillabel="').concat(e.data.type.value,'", labeldistance=3];')),t.physicalGraphLineNodes.serviceDesign[e.data.service_design.guid]=e.data.service_design,t.physicalGraphLineNodes.unitDesign[e.data.unit_design.guid]=e.data.unit_design}),[this.renderNode(e,"doubleoctagon")].concat(Object(a["a"])(this.renderServiceNode(n,e))).join("")},renderNode:function(e,t){return this.physicalGraphNodes[e.guid]=e,'"gn_'.concat(e.guid,'" [label="').concat(e.data.code,'", id="gn_').concat(e.guid,'", shape=').concat(t||"ellipse",',style="filled", color="').concat(g.get(e.data.state.code),'", tooltip="').concat(e.data.description||e.data.name,'"]')},renderServiceNode:function(e,t){var n=this,a=[];return e.length&&e.forEach(function(e){a=a.concat([n.renderNode(e),'"gn_'.concat(e.guid,'" -> "gn_').concat(t.guid,'" [arrowhead = "t"]')])}),a},renderOtherNodes:function(){var e=this,t="";return Object.keys(this.physicalGraphLineNodes.serviceDesign).forEach(function(n){if(!e.physicalGraphNodes[n]){var a=e.physicalGraphLineNodes.serviceDesign[n];t+='"gn_'.concat(a.guid,'" [label="').concat(a.code,'",id="gn_').concat(a.guid,'",shape="ellipse",tooltip="').concat(a.description||a.name,'"]')}}),Object.keys(this.physicalGraphLineNodes.unitDesign).forEach(function(n){if(!e.physicalGraphNodes[n]){var a=e.physicalGraphLineNodes.unitDesign[n];t+='"gn_'.concat(a.guid,'" [label="').concat(a.code,'",id="gn_').concat(a.guid,'",shape="doubleoctagon",tooltip="').concat(a.description||a.name,'"]')}}),t},renderGraph:function(e){var t=this.genDOT(e);this.graph.graphviz.renderDot(t);var n=o["select"]("#graph").select("svg"),a=n.attr("width"),i=n.attr("height");n.attr("viewBox","0 0 "+a+" "+i)},shadeAll:function(){o["selectAll"]("g path").attr("stroke","#7f8fa6").attr("stroke-opacity",".2"),o["selectAll"]("g polygon").attr("stroke","#7f8fa6").attr("stroke-opacity",".2").attr("fill","#7f8fa6").attr("fill-opacity",".2"),o["selectAll"]("g ellipse").attr("stroke","#7f8fa6").attr("stroke-opacity",".2").attr("fill","#7f8fa6").attr("fill-opacity",".2"),o["selectAll"]("text").attr("fill","#000")},reColorCurrentInvokeSequenceLine:function(e,t){var n=o["select"]("#"+"gl_".concat(e.guid)).attr("stroke",t).attr("stroke-opacity","1");n.select("path").attr("stroke",t).attr("stroke-opacity","1"),n.select("polygon").attr("fill",t).attr("stroke",t).attr("stroke-opacity","1")},reColorCurrentInvokeSequenceNode:function(e,t,n){var a=o["select"]("#"+"gn_".concat(e));a.selectAll(t).attr("fill",n).attr("stroke",n).attr("stroke-opacity","1")},handleTabClick:function(e){this.payload.filters=[],this.currentTab=e,"architecture-design"!==e&&"physicalGraph"!==e&&this.getCurrentData()},onSelectedRowsChange:function(e,t){var n=this;if(e.length>0){var a=[],i=[];e.forEach(function(e,t){a.push(!!e.nextOperations.find(function(e){return"update"===e})),i.push(!!e.nextOperations.find(function(e){return"delete"===e}))});var r=function(e){return!0===e};this.tabList.forEach(function(e){e.id===n.currentTab&&e.outerActions.forEach(function(e){switch(e.actionType){case"add":e.props.disabled="add"===e.actionType;break;case"edit":e.props.disabled=!a.every(r);break;case"delete":e.props.disabled=!i.every(r);break;default:break}})})}else this.tabList.forEach(function(e){e.id===n.currentTab&&e.outerActions.forEach(function(e){e.props.disabled=!("add"===e.actionType||"export"===e.actionType||"cancel"===e.actionType)})})},actionFun:function(e,t){switch(e){case"export":this.exportHandler();break;case"add":this.addHandler();break;case"edit":this.editHandler();break;case"save":this.saveHandler(t);break;case"delete":this.deleteHandler(t);break;case"cancel":this.cancelHandler();break;case"innerCancel":this.$refs[this.tableRef][0].rowCancelHandler(t.weTableRowId);break;default:this.defaultHandler(e,t);break}},sortHandler:function(e){this.payload.sorting={asc:"asc"===e.order,field:e.key},this.queryCiData()},handleSubmit:function(e){this.payload.filters=e,this.queryCiData()},defaultHandler:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t,n){var a,i,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["Rb"])(this.currentTab,n.guid,t);case 2:a=e.sent,a.data,i=a.status,r=a.message,"OK"===i&&(this.$Notice.success({title:t,desc:r}),this.queryCiData());case 7:case"end":return e.stop()}},e,this)}));function t(t,n){return e.apply(this,arguments)}return t}(),addHandler:function(){var e=this;this.tabList.forEach(function(t){if(t.id===e.currentTab){var n={};t.tableColumns.forEach(function(e){"multiSelect"===e.inputType||"multiRef"===e.inputType?n[e.inputKey]=[]:n[e.inputKey]=""}),n["isRowEditable"]=!0,n["isNewAddedRow"]=!0,n["weTableRowId"]=1,n["nextOperations"]=[],t.tableData.unshift(n),e.$nextTick(function(){e.$refs[e.tableRef][0].pushNewAddedRowToSelections(),e.$refs[e.tableRef][0].setCheckoutStatus(!0)}),t.outerActions.forEach(function(e){e.props.disabled="add"===e.actionType})}})},cancelHandler:function(){var e=this;this.$refs[this.tableRef][0].setAllRowsUneditable(),this.$refs[this.tableRef][0].setCheckoutStatus(),this.tabList.forEach(function(t){t.id===e.currentTab&&t.outerActions.forEach(function(e){e.props.disabled=!("add"===e.actionType||"export"===e.actionType||"cancel"===e.actionType)})})},deleteHandler:function(e){var t=this;this.$Modal.confirm({title:"确认删除？","z-index":1e6,onOk:function(){var n=Object(s["a"])(regeneratorRuntime.mark(function n(){var a,i,r,s,o;return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:return a=t.tabList.find(function(e){return e.id===t.currentTab}),i={id:a&&a.code,deleteData:e.map(function(e){return e.guid})},n.next=4,Object(c["s"])(i);case 4:r=n.sent,s=r.status,o=r.message,r.data,"OK"===s&&(t.$Notice.success({title:"Delete data Success",desc:o}),t.tabList.forEach(function(e){e.id===t.currentTab&&e.outerActions.forEach(function(e){e.props.disabled="save"===e.actionType||"edit"===e.actionType||"delete"===e.actionType})}),t.isDataChanged=!0,t.queryCiData());case 9:case"end":return n.stop()}},n)}));function a(){return n.apply(this,arguments)}return a}(),onCancel:function(){}}),document.querySelector(".ivu-modal-mask").click()},editHandler:function(){var e=this;this.$refs[this.tableRef][0].swapRowEditable(!0),this.tabList.forEach(function(t){t.id===e.currentTab&&t.outerActions.forEach(function(e){"save"===e.actionType&&(e.props.disabled=!1)})}),this.$nextTick(function(){e.$refs[e.tableRef][0].setCheckoutStatus(!0)})},deleteAttr:function(){var e=this,t=[],n=this.tabList.find(function(t){return t.id===e.currentTab});return n.tableColumns.forEach(function(e){e.isAuto&&t.push(e.propertyName)}),t},saveHandler:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var n,a,i,r,s,o,u,l,d,h,p,f,g,v,m,b=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(n=function(){b.tabList.forEach(function(e){e.id===b.currentTab&&e.outerActions.forEach(function(e){e.props.disabled=!("add"===e.actionType||"export"===e.actionType)})}),b.$refs[b.tableRef][0].setAllRowsUneditable(),b.$nextTick(function(){var e=b.$refs[b.tableRef][0].$refs.table.$refs.tbody.objData;for(var t in e)e[t]._isChecked=!1,e[t]._isDisabled=!1})},a=JSON.parse(JSON.stringify(t)),i=a.filter(function(e){return e.isNewAddedRow}),r=a.filter(function(e){return!e.isNewAddedRow}),!(i.length>0)){e.next=16;break}return s=this.deleteAttr(),i.forEach(function(e){s.forEach(function(t){delete e[t]}),delete e.isRowEditable,delete e.weTableForm,delete e.weTableRowId,delete e.isNewAddedRow,delete e.nextOperations}),o=this.tabList.find(function(e){return e.id===b.currentTab}),u={id:o&&o.code,createData:i},e.next=11,Object(c["h"])(u);case 11:l=e.sent,d=l.status,h=l.message,l.data,"OK"===d&&(this.$Notice.success({title:"Add data Success",desc:h}),this.isDataChanged=!0,n(),this.queryCiData());case 16:if(!(r.length>0)){e.next=27;break}return r.forEach(function(e){delete e.isRowEditable,delete e.weTableForm,delete e.weTableRowId,delete e.isNewAddedRow,delete e.nextOperations}),p=this.tabList.find(function(e){return e.id===b.currentTab}),f={id:p&&p.code,updateData:r},e.next=22,Object(c["yc"])(f);case 22:g=e.sent,v=g.status,m=g.message,g.data,"OK"===v&&(this.$Notice.success({title:"Update data Success",desc:m}),this.isDataChanged=!0,n(),this.queryCiData());case 27:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),exportHandler:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,a,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=f({},this.payload,{paging:!1}),e.next=3,Object(c["W"])(this.currentTab,this.systemDesignVersion,t);case 3:n=e.sent,a=n.status,n.message,i=n.data,"OK"===a&&this.$refs[this.tableRef][0].export({filename:"Ci Data",data:Object(l["a"])(i.contents.map(function(e){return e.data}))});case 8:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),pageChange:function(e){var t=this;this.tabList.forEach(function(n){n.id===t.currentTab&&(n.pagination.currentPage=e)}),this.queryCiData()},pageSizeChange:function(e){var t=this;this.tabList.forEach(function(n){n.id===t.currentTab&&(n.pagination.pageSize=e)}),this.queryCiData()},queryCiData:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,a,i,r=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.payload.pageable.pageSize=10,this.payload.pageable.startIndex=0,this.tabList.forEach(function(e){e.id===r.currentTab&&(r.payload.pageable.pageSize=e.pagination.pageSize,r.payload.pageable.startIndex=(e.pagination.currentPage-1)*e.pagination.pageSize)}),t=this.tabList.find(function(e){return e.code===r.currentTab}),e.next=6,Object(c["W"])(t.codeId,this.systemDesignVersion,this.payload);case 6:n=e.sent,a=n.status,n.message,i=n.data,"OK"===a&&this.tabList.forEach(function(e){e.id===r.currentTab&&(e.tableData=i?i.contents.map(function(e){return f({},e.data,{nextOperations:e.meta.nextOperations||[]})}):[],e.pagination.total=i?i.pageInfo.totalRows:0)});case 11:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),queryCiAttrs:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var n,a,i,r,s,o=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["eb"])(t);case 2:n=e.sent,a=n.status,n.message,i=n.data,[],r=["created_date","updated_date","created_by","updated_by","key_name","guid"],"OK"===a&&(s=[],i.forEach(function(e){r.find(function(t){return t===e.propertyName});var t=e.propertyName;if("decommissioned"!==e.status&&"notCreated"!==e.status){var n="invoke_design_sequence"===e.propertyName?{component:"sequenceDiagram"}:f({},u["a"][e.inputType]);s.push(f({},e,{title:e.name,key:t,inputKey:e.propertyName,inputType:e.inputType,referenceId:e.referenceId,disEditor:!e.isEditable,disAdded:!e.isEditable,placeholder:e.name,component:"Input",ciType:{id:e.referenceId,name:e.name},type:"text"},n))}}),this.tabList.forEach(function(e){e.id===o.currentTab&&(e.tableColumns=o.getSelectOptions(s))}));case 9:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),getSelectOptions:function(e){return e.forEach(function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var n,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if("select"!==t.inputType){e.next=8;break}return e.next=3,Object(c["mb"])(0,t.referenceId);case 3:n=e.sent,n.status,n.message,a=n.data,t["options"]=a.filter(function(e){return"active"===e.status}).map(function(e){return{label:e.value,value:e.codeId}});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e},getCurrentData:function(){this.queryCiAttrs(this.currentTab),this.queryCiData()},getArchitectureDesignTabs:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,a,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["X"])();case 2:return t=e.sent,n=t.data,a=t.status,t.message,e.next=8,Object(d["a"])();case 8:i=e.sent,"OK"===a&&(this.tabList=n.map(function(e){return f({},e,{name:e.value,id:e.code,tableData:[],tableColumns:[],outerActions:JSON.parse(JSON.stringify(u["c"])),innerActions:JSON.parse(JSON.stringify(u["b"].concat(i))),pagination:JSON.parse(JSON.stringify(u["d"])),ascOptions:{}})}));case 10:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),onSystemDesignSelect:function(e){this.systemDesignVersion=e,"architecture-design"!==this.currentTab&&"physicalGraph"!==this.currentTab&&this.getCurrentData()},getSystemDesigns:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["Lb"])();case 2:t=e.sent,n=t.status,a=t.data,t.message,"OK"===n&&(this.systemDesigns=a.contents.map(function(e){return e.data}));case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},created:function(){this.getArchitectureDesignTabs(),this.getSystemDesigns()}},b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Row",[n("Row",[n("Col",{attrs:{span:"12"}},[n("Row",[n("span",{staticStyle:{"margin-right":"10px"}},[e._v("系统设计")]),e._v(" "),n("Select",{staticStyle:{width:"35%"},attrs:{filterable:"","label-in-name":""},on:{"on-change":e.onSystemDesignSelect}},e._l(e.systemDesigns,function(t){return n("Option",{key:t.guid,attrs:{value:t.guid}},[e._v(e._s(t.name))])}),1),e._v(" "),n("Button",{staticStyle:{margin:"0 10px"},on:{click:e.onArchChange}},[e._v("架构变更")]),e._v(" "),n("Button",{on:{click:e.querySysTree}},[e._v("去定版")]),e._v(" "),n("Modal",{attrs:{width:"500px",title:"去定版"},model:{value:e.fixVersionTreeModal,callback:function(t){e.fixVersionTreeModal=t},expression:"fixVersionTreeModal"}},[n("div",{staticStyle:{"max-height":"600px",overflow:"auto"}},[n("Tree",{attrs:{data:e.deployTree}})],1),e._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{on:{click:e.cancelFixVersion}},[e._v("取消定版")]),e._v(" "),n("Button",{attrs:{type:"info"},on:{click:e.onArchFixVersion}},[e._v("确定定版")])],1)])],1)],1)],1),e._v(" "),n("Card",{staticStyle:{"margin-top":"20px"}},[n("div",[n("Tabs",{attrs:{type:"card",value:e.currentTab,closable:!1},on:{"on-click":e.handleTabClick}},[n("TabPane",{attrs:{label:"应用逻辑图",name:"architecture-design"}},[e.isDataChanged?n("Alert",{attrs:{"show-icon":"",closable:""}},[e._v("\n            Data has beed changed, click Reload button to reload graph.\n            "),n("Button",{attrs:{slot:"desc"},on:{click:e.reloadHandler},slot:"desc"},[e._v("Reload")])],1):e._e(),e._v(" "),e.spinShow?n("Spin",{attrs:{size:"large",fix:""}},[n("Icon",{staticClass:"spin-icon-load",attrs:{type:"ios-loading",size:"44"}}),e._v(" "),n("div",[e._v("加载中...")])],1):e._e(),e._v(" "),n("Row",[n("Col",{attrs:{span:"18"}},[n("div",{staticStyle:{"padding-right":"20px"}},[n("div",{staticClass:"graph-container",attrs:{id:"graph"}})])]),e._v(" "),e.isShowInvokeSequence?n("Col",{staticClass:"func-wrapper",attrs:{span:"6",offset:"0"}},[n("Collapse",[n("Panel",{attrs:{name:"invokeDesignSequence"}},[n("b",[e._v("调用时序设计")]),e._v(" "),n("Form",{ref:"invokeSequenceForm",attrs:{slot:"content",model:e.invokeSequenceForm,"label-position":"left","label-width":120},slot:"content"},[n("Form-item",{attrs:{label:"调用时序设计"}},[n("Row",[n("Select",{staticStyle:{width:"calc(100% - 70px)"},attrs:{placeholder:"请选择"},model:{value:e.invokeSequenceForm.selectedInvokeSequence,callback:function(t){e.$set(e.invokeSequenceForm,"selectedInvokeSequence",t)},expression:"invokeSequenceForm.selectedInvokeSequence"}},e._l(e.invokeSequenceForm.invokeSequenceData,function(t){return n("Option",{key:t.data.guid,attrs:{value:t.data.guid}},[e._v(e._s(t.data.code))])}),1),e._v(" "),n("Button",{staticStyle:{"margin-right":"10px",float:"right"},on:{click:e.onSearchInvokeSquence}},[e._v("确定")])],1)],1),e._v(" "),e.invokeSequenceForm.isShowInvokeSequenceDetial?n("Form-item",{attrs:{label:"调用时序设计序列"}},[n("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(e.invokeSequenceForm.spliceInvokeSequenceList))])]):e._e(),e._v(" "),e.invokeSequenceForm.isShowInvokeSequenceDetial?n("Form-Item",{attrs:{label:"当前调用"}},[n("Row",[n("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(e.invokeSequenceForm.currentInvokeSequenceTag))]),e._v(" "),n("span",{staticClass:"header-buttons-container margin-right",staticStyle:{float:"right"}},[n("Tooltip",{attrs:{content:"上一步",placement:"top-start"}},[n("Button",{attrs:{size:"small",icon:"md-arrow-round-back"},on:{click:e.backInvokeSequence}})],1),e._v(" "),n("span",[e._v(e._s(e.invokeSequenceForm.currentNum)+"/"+e._s(e.invokeSequenceForm.totalNum))]),e._v(" "),n("Tooltip",{attrs:{content:"下一步",placement:"top-start"}},[n("Button",{attrs:{size:"small",icon:"md-arrow-round-forward"},on:{click:e.nextInvokeSequence}})],1)],1)])],1):e._e(),e._v(" "),e.invokeSequenceForm.isShowInvokeSequenceDetial?n("Form-Item",[n("Button",{staticStyle:{"margin-right":"calc(50% + 35px)",float:"right"},on:{click:e.closeInvokeSquence}},[e._v("返回")])],1):e._e()],1)],1)],1)],1):e._e()],1)],1),e._v(" "),n("TabPane",{attrs:{label:"物理部署图",name:"physicalGraph"}},[n("div",{attrs:{id:"physicalGraph"}},[e.physicalGraphData.length?n("PhysicalGraph",{attrs:{graphData:e.physicalGraphData,links:e.physicalGraphLinks,callback:e.graphCallback}}):e._e(),e._v(" "),e.physicalSpin?n("Spin",{attrs:{size:"large",fix:""}},[n("Icon",{staticClass:"spin-icon-load",attrs:{type:"ios-loading",size:"44"}}),e._v(" "),n("div",[e._v("加载中...")])],1):e._e()],1)]),e._v(" "),e._l(e.tabList,function(t){return e.systemDesignVersion?n("TabPane",{key:t.id,attrs:{name:t.id,label:t.name}},[n("WeTable",{ref:"table"+t.id,refInFor:!0,attrs:{tableData:t.tableData,tableOuterActions:t.outerActions,tableInnerActions:t.innerActions,tableColumns:t.tableColumns,pagination:t.pagination,ascOptions:t.ascOptions,showCheckbox:e.needCheckout,tableHeight:"650"},on:{actionFun:e.actionFun,handleSubmit:e.handleSubmit,sortHandler:e.sortHandler,getSelectedRows:e.onSelectedRowsChange,pageChange:e.pageChange,pageSizeChange:e.pageSizeChange}})],1):e._e()})],2)],1)])],1)},k=[],y=n("2455");function S(e){n("7168")}var w=!1,q=S,D="data-v-301ff99e",_=null,x=Object(y["a"])(m,b,k,w,q,D,_);t["default"]=x.exports}}]);
//# sourceMappingURL=chunk-7df42495.2a78e2b7.js.map